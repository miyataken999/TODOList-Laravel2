name: Deploy Laravel TODOList to Hugging Face Spaces

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        fetch-depth: 0  # å…¨å±¥æ­´ã‚’å–å¾—
        lfs: true  # Git LFS ã‚µãƒãƒ¼ãƒˆ
    
    - name: Setup PHP
      uses: shivammathur/setup-php@v2
      with:
        php-version: '8.1'
        extensions: mbstring, xml, curl, sqlite3, mysql, zip, bcmath
    
    - name: Install Composer dependencies
      run: composer install --no-interaction --prefer-dist --optimize-autoloader
    
    - name: Setup environment
      run: |
        cp .env.example .env
        php artisan key:generate
        touch database/database.sqlite
        
    - name: Configure Git for Hugging Face
      run: |
        git config --global user.email "action@github.com"
        git config --global user.name "GitHub Action"
    
    - name: Deploy to Hugging Face Spaces
      env:
        HF_TOKEN: ${{ secrets.HF_TOKEN }}
      run: |
        # Hugging Face Spacesã«ãƒ—ãƒƒã‚·ãƒ¥
        git remote set-url origin https://oauth2:$HF_TOKEN@huggingface.co/spaces/kenken999/TODOList-Laravel2
        
        # READMEã‚’æ›´æ–°
        echo "ðŸ“ Updating README.md with deployment info..."
        cat > README.md << 'EOF'
        ---
        title: TODOList Laravel
        emoji: ðŸ“
        colorFrom: yellow
        colorTo: red
        sdk: docker
        pinned: false
        app_port: 8000
        ---

        # Laravel TODOList - Hugging Face Spaces

        ðŸš€ **Laravel TODOã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ with GitHub Actionsè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤**

        ## ðŸŒŸ ç‰¹å¾´

        - âœ… **GitHub Actionsè‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤**
        - ðŸŽ¨ **Laravel + Vue.js UI**
        - ðŸ“ **TODOãƒªã‚¹ãƒˆç®¡ç†**
        - ðŸ³ **Dockerå¯¾å¿œ**
        - ðŸŒ **Hugging Face Spaceså®Œå…¨å¯¾å¿œ**

        ## ðŸš€ ã‚¢ã‚¯ã‚»ã‚¹

        Laravel TODOã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã«ã‚¢ã‚¯ã‚»ã‚¹ï¼š
        - ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸: `/`
        - API ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ: `/api/todos`

        ## ðŸ”„ è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤

        ã“ã®ã‚¹ãƒšãƒ¼ã‚¹ã¯GitHub Actionsã§è‡ªå‹•æ›´æ–°ã•ã‚Œã¾ã™ï¼š
        - `main`ãƒ–ãƒ©ãƒ³ãƒã¸ã®ãƒ—ãƒƒã‚·ãƒ¥ã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
        - æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½
        - Laravel ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®æœ€æ–°ç‰ˆã‚’å¸¸ã«åæ˜ 

        ## ðŸ“¡ æœ€çµ‚æ›´æ–°

        Last deployed: $(date -u '+%Y-%m-%d %H:%M:%S UTC')

        ## About Laravel

        Laravel is a web application framework with expressive, elegant syntax. 
        This TODO application demonstrates Laravel's capabilities with:
        - RESTful API endpoints
        - Database migrations
        - Eloquent ORM
        - Vue.js frontend integration
        
        EOF
        
        # å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
        git add .
        git commit -m "ðŸš€ Auto-deploy Laravel TODOList from GitHub Actions $(date -u '+%Y-%m-%d %H:%M:%S UTC')

        âœ… Features updated:
        - Laravel TODOList Application
        - GitHub Actions auto-deployment
        - Docker containerization
        - Vue.js frontend
        - RESTful API endpoints
        
        ðŸ¤– Deployed via GitHub Actions"
        
        # Hugging Face Spacesã«ãƒ—ãƒƒã‚·ãƒ¥
        git push origin main --force
        
        echo "âœ… Successfully deployed to Hugging Face Spaces!"
        echo "ðŸŒ Check your space at: https://huggingface.co/spaces/kenken999/TODOList-Laravel2"
    
    - name: Deployment Summary
      run: |
        echo "## ðŸš€ Laravel TODOList Deployment Summary" >> $GITHUB_STEP_SUMMARY
        echo "- **Status**: âœ… Success" >> $GITHUB_STEP_SUMMARY
        echo "- **Target**: Hugging Face Spaces" >> $GITHUB_STEP_SUMMARY
        echo "- **Space URL**: https://huggingface.co/spaces/kenken999/TODOList-Laravel2" >> $GITHUB_STEP_SUMMARY
        echo "- **Timestamp**: $(date -u '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY
        echo "- **Framework**: Laravel with Vue.js" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### ðŸ“Š Application Features" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Laravel TODO application" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… RESTful API endpoints" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Vue.js frontend" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… Docker containerization" >> $GITHUB_STEP_SUMMARY
        echo "- âœ… GitHub Actions auto-deployment" >> $GITHUB_STEP_SUMMARY
